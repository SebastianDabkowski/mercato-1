@page
@model Mercato.Web.Pages.Seller.Settings.PayoutSettingsModel
@{
    ViewData["Title"] = "Payout Settings";
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-credit-card me-2"></i>Payout Settings</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">Configure your bank account and payout preferences to receive funds from sales on the marketplace.</p>

                    @if (Model.IsIncomplete)
                    {
                        <div class="alert alert-warning" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <strong>Action Required:</strong> Your payout configuration is incomplete. Please complete the required fields below before you can receive payouts.
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                    {
                        <div class="alert alert-success" role="alert">
                            <i class="bi bi-check-circle-fill me-2"></i>@Model.SuccessMessage
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                    {
                        <div class="alert alert-danger" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>@Model.ErrorMessage
                        </div>
                    }

                    <form method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <div class="alert alert-info mb-4" role="alert">
                            <i class="bi bi-shield-lock-fill me-2"></i>
                            <strong>Security:</strong> Your banking information is encrypted and stored securely.
                        </div>

                        <!-- Payout Method Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Preferred Payout Method <span class="text-danger">*</span></label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check border rounded p-3 @(Model.PreferredPayoutMethod == Mercato.Seller.Domain.Entities.PayoutMethod.BankTransfer ? "border-primary bg-light" : "")">
                                        <input class="form-check-input" type="radio" name="PreferredPayoutMethod" id="bankTransfer" 
                                               value="@((int)Mercato.Seller.Domain.Entities.PayoutMethod.BankTransfer)" 
                                               @(Model.PreferredPayoutMethod == Mercato.Seller.Domain.Entities.PayoutMethod.BankTransfer ? "checked" : "")
                                               onchange="togglePayoutMethod()" />
                                        <label class="form-check-label w-100" for="bankTransfer">
                                            <i class="bi bi-bank me-2"></i><strong>Bank Transfer</strong>
                                            <div class="text-muted small mt-1">Receive payouts directly to your bank account via SWIFT/IBAN.</div>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check border rounded p-3 @(Model.PreferredPayoutMethod == Mercato.Seller.Domain.Entities.PayoutMethod.PaymentAccount ? "border-primary bg-light" : "")">
                                        <input class="form-check-input" type="radio" name="PreferredPayoutMethod" id="paymentAccount" 
                                               value="@((int)Mercato.Seller.Domain.Entities.PayoutMethod.PaymentAccount)" 
                                               @(Model.PreferredPayoutMethod == Mercato.Seller.Domain.Entities.PayoutMethod.PaymentAccount ? "checked" : "")
                                               onchange="togglePayoutMethod()" />
                                        <label class="form-check-label w-100" for="paymentAccount">
                                            <i class="bi bi-wallet2 me-2"></i><strong>Payment Account</strong>
                                            <div class="text-muted small mt-1">Receive payouts to your PayPal or Stripe account.</div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Transfer Fields -->
                        <div id="bankTransferFields" class="@(Model.PreferredPayoutMethod == Mercato.Seller.Domain.Entities.PayoutMethod.BankTransfer ? "" : "d-none")">
                            <h5 class="mb-3 border-bottom pb-2"><i class="bi bi-bank me-2"></i>Bank Transfer Details</h5>
                            
                            <div class="mb-3">
                                <label asp-for="BankName" class="form-label">Bank Name <span class="text-danger">*</span></label>
                                <input asp-for="BankName" class="form-control" placeholder="Enter your bank name" />
                                <span asp-validation-for="BankName" class="text-danger"></span>
                                <div class="form-text">The name of your bank or financial institution.</div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="AccountHolderName" class="form-label">Account Holder Name <span class="text-danger">*</span></label>
                                <input asp-for="AccountHolderName" class="form-control" placeholder="Enter the name on your bank account" />
                                <span asp-validation-for="AccountHolderName" class="text-danger"></span>
                                <div class="form-text">The name as it appears on your bank account.</div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="BankAccountNumber" class="form-label">Bank Account Number <span class="text-danger">*</span></label>
                                <input asp-for="BankAccountNumber" class="form-control" placeholder="Enter your bank account number" />
                                <span asp-validation-for="BankAccountNumber" class="text-danger"></span>
                                <div class="form-text">Your bank account number for receiving payments.</div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="BankRoutingNumber" class="form-label">Bank Routing Number</label>
                                <input asp-for="BankRoutingNumber" class="form-control" placeholder="Enter your bank routing number" />
                                <span asp-validation-for="BankRoutingNumber" class="text-danger"></span>
                                <div class="form-text">Your bank's routing number (ABA number for US banks).</div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="SwiftCode" class="form-label">SWIFT/BIC Code</label>
                                    <input asp-for="SwiftCode" class="form-control" placeholder="e.g., ABCDUS33XXX" />
                                    <span asp-validation-for="SwiftCode" class="text-danger"></span>
                                    <div class="form-text">For international transfers.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Iban" class="form-label">IBAN</label>
                                    <input asp-for="Iban" class="form-control" placeholder="e.g., DE89370400440532013000" />
                                    <span asp-validation-for="Iban" class="text-danger"></span>
                                    <div class="form-text">International Bank Account Number.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Account Fields -->
                        <div id="paymentAccountFields" class="@(Model.PreferredPayoutMethod == Mercato.Seller.Domain.Entities.PayoutMethod.PaymentAccount ? "" : "d-none")">
                            <h5 class="mb-3 border-bottom pb-2"><i class="bi bi-wallet2 me-2"></i>Payment Account Details</h5>
                            
                            <div class="mb-3">
                                <label asp-for="PaymentAccountEmail" class="form-label">Payment Account Email</label>
                                <input asp-for="PaymentAccountEmail" class="form-control" type="email" placeholder="your-email@example.com" />
                                <span asp-validation-for="PaymentAccountEmail" class="text-danger"></span>
                                <div class="form-text">The email associated with your PayPal or similar payment account.</div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="PaymentAccountId" class="form-label">Payment Account ID</label>
                                <input asp-for="PaymentAccountId" class="form-control" placeholder="e.g., acct_1234567890" />
                                <span asp-validation-for="PaymentAccountId" class="text-danger"></span>
                                <div class="form-text">Your Stripe Connect account ID or similar.</div>
                            </div>

                            <div class="alert alert-secondary" role="alert">
                                <i class="bi bi-info-circle me-2"></i>
                                Provide either a payment account email or account ID.
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a asp-page="/Seller/Index" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-lg me-1"></i>Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function togglePayoutMethod() {
            var bankTransfer = document.getElementById('bankTransfer').checked;
            var bankTransferFields = document.getElementById('bankTransferFields');
            var paymentAccountFields = document.getElementById('paymentAccountFields');
            
            if (bankTransfer) {
                bankTransferFields.classList.remove('d-none');
                paymentAccountFields.classList.add('d-none');
            } else {
                bankTransferFields.classList.add('d-none');
                paymentAccountFields.classList.remove('d-none');
            }
            
            // Update visual selection
            document.querySelectorAll('.form-check.border').forEach(function(el) {
                el.classList.remove('border-primary', 'bg-light');
            });
            
            var selected = document.querySelector('input[name="PreferredPayoutMethod"]:checked');
            if (selected) {
                selected.closest('.form-check').classList.add('border-primary', 'bg-light');
            }
        }
    </script>
}
